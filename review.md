# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
FORMとかで、文字を送信する時に、スクリプト処理を埋め込む攻撃
<script></script>はJavaScriptのコードの埋め込みとか参照に使われる。
つまり、送信した先で、書き込んだJSの処理を行わせる。
クッキー情報を取得できる。ログイン情報や付随した個人情報等を取得できる。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
様々なものにつける為、eと定義して簡略化している。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
エスケープ処理の種類を第二引数で指定すると、特定の記号、
例えば講座でやったENT_QUOTEだと'' "" > < これらの記号をブラウザを通す際に文字列に変換される為。
## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
相手に自分か意図した行動を起こさせる攻撃。
例えば競合他社のサイトを荒らして、信用を失わせたりできる。
### SessionとCookieの違いを説明してください。
セッション情報はクッキーの一部で、ページからもらう、操作に紐づいたセッションIDなどがあり、サーバー側で管理している。
クッキー情報はユーザーに関する情報をユーザーのブラウザで保存しているもの。
### `setToken()`が何をしているか説明してください。
openssl_random_pseudo_bytes(16)で、ランダムな16文字のバイト文字列を生成して、
その文字列をbin2hexで16進数に変換している。
返還後の値を$_SESSION['token']に入れ込んでいる。
### `checkToken()`が何をしているか説明してください。
もし、$_SESSION['token']が空の場合と、$_SESSION['token']と$tokenが等しくない時に、$_SESSION['err']に'不正な操作です'という文字列を入れている。
### トークンを使うことでなぜCSRFが防げるのか説明してください。
他サイト経由では、トークンを埋め込んだページを再現できないため。
サーバー側から一時的に発行されるトークンをすり合わせて一致した場合のみ、処理が実行されるようにしている為。
## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
FORMなどの文字列を入力する場所に、サーバーを操作するSQL文を直接入力し、データベースを操作するもの。
DB内の情報を抜き取って悪用できたり、例えば他社の持っている情報を削除したりできる。
### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
オブジェクト型のSQL文。
プレースホルダー(変数)を使ってSQL文の準備をしている。
### `->bindValue()`が何をしているか説明してください。
さきほど->prepare()でプレースホルダーを使った箇所に実際の値をバインド(割り当て)している。
返り値はTrueかFalseのブーリアン型
### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
プレースホルダーを使ってワンクッション入れて、bindValueでString型で値をSQL文に入れるため、コメントアウトの部分や、セミコロンといった、様々な部分でSQL文の文法エラーが発生するため。
bindValueでINT型を指定した時は普通にエラーになる。
## バリデーション

### バリデーションの目的について説明してください。
FORM等で入力された値が求めている形かどうかを判断できる
### `validate()`が何をしているか説明してください。
$post['content']の中身が空かどうか判定して、空の場合は入力がありません。
という文字列を$_SESSIN['err']に入れて、redirectToPostedPage();を実行して、
header関数を使って以前のページに戻して、処理を終了させてる。
### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
削除の時にindex.phpにcontentが存在しないため、content===''はそもそもとしてエラーが出る。
issetであるかないかを判定して、無いと最初に出さないとエラーになる為、前に持ってきて書かないといけない。
index.phpにcontentをhiddenで、content=""書けばこっちは書かなくていい。
## その他

### `unsetError()`を実行しないとどうなるか説明してください。
エラー文が残り続けてindex.phpに行っても、入力がありませんなどのエラー文が表示されたままになってしまう。